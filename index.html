<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Specialized Turbo Levo 2018 Dashboard</title>
    <style>
        /* Reset e stili base */
        body, html {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background-color: #1e1e1e;
            color: white;
            height: 100%;
            width: 100%;
            overflow: hidden;
        }

        /* Forza orientamento orizzontale */
        @media screen and (orientation: portrait) {
            body {
                transform: rotate(-90deg);
                transform-origin: left top;
                width: 100vh;
                height: 100vw;
                position: absolute;
                top: 100%;
                left: 0;
            }
        }

        /* Layout principale */
        .dashboard {
            display: flex;
            width: 812px;
            height: 375px;
            padding: 10px;
            gap: 10px;
            margin: 0 auto;
        }

        /* Sezione velocità ridimensionata e centrata */
        .speed-section {
            flex: 1;
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            max-width: 260px;
            position: relative;
            overflow: hidden;
        }

        /* Contenitore tachimetro centrato */
        .speedometer {
            width: 200px;
            height: 140px;
            position: relative;
            margin: 20px auto;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .speed-title {
            position: absolute;
            top: -15px;
            width: 100%;
            text-align: center;
            font-size: 14px;
            opacity: 0.8;
            text-transform: uppercase;
        }

        .speed-arc {
            width: 200px;
            height: 110px;
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
        }

        .speed-led {
            position: absolute;
            width: 8px;
            height: 3px;
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
            transform-origin: center 55px;
            left: calc(50% - 4px);
            transition: background-color 0.3s ease;
        }

        .speed-led.active.eco { background-color: #4CAF50; }
        .speed-led.active.cruise { background-color: #FFC107; }
        .speed-led.active.power { background-color: #F44336; }

        .speed-display {
            position: absolute;
            left: 50%;
            bottom: 10px;
            transform: translateX(-50%);
            text-align: center;
            z-index: 1;
            width: 100%;
        }

        .speed-value {
            font-size: 38px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin: 0;
            line-height: 1;
        }

        .speed-unit {
            font-size: 14px;
            opacity: 0.8;
            margin-top: 5px;
        }

        /* Sezione metriche (2/3 destro) */
        .metrics-section {
            flex: 2;
            display: grid;
            grid-template-rows: repeat(3, 1fr);
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            max-width: 520px;
        }

        .metric-card {
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
        }

        h3 {
            margin: 0;
            font-size: 14px;
            opacity: 0.8;
            text-transform: uppercase;
        }

        .metric-value {
            font-size: 24px;
            font-weight: bold;
            margin: 4px 0;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        /* Stile LED comune */
        .led-container {
            display: flex;
            gap: 2px;
            width: 100%;
            margin: 4px 0;
        }

        .led-segment {
            flex: 1;
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            transition: background-color 0.3s ease;
        }

        /* Stili indicatori specifici */
        .battery-segment.active { background-color: #4CAF50; }
        .battery-segment.reserve { background-color: #F44336; }

        .power-segment.active.low { background-color: #4CAF50; }
        .power-segment.active.medium { background-color: #FFC107; }
        .power-segment.active.high { background-color: #F44336; }

        .slope-segment.descent { background-color: #2196F3; }
        .slope-segment.climb { background-color: #F44336; }

        .assist-level.eco { background-color: #4CAF50; }
        .assist-level.trail { background-color: #FFC107; }
        .assist-level.turbo { background-color: #F44336; }

        /* Stile aggiornato per il pulsante di connessione */
        #connect-button {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            z-index: 9999;
            transform: rotate(0deg);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        #connect-button:hover { 
            background: #45a049;
            box-shadow: 0 3px 7px rgba(0,0,0,0.3);
        }

        #connect-button:disabled { 
            background: #cccccc;
            cursor: not-allowed;
            box-shadow: none;
        }

        /* Stili per dispositivi mobili */
        @media screen and (max-width: 812px) {
            .dashboard {
                width: 100vw;
                height: 100vh;
            }
            
            #connect-button {
                font-size: 14px;
                padding: 10px 16px;
            }
        }
    </style>
</head>
<body>
   <button id="connect-button">Connetti</button>
   <div class="dashboard">
       <!-- Sezione Velocità (1/3 sinistro) -->
       <div class="speed-section">
           <div class="speedometer">
               <div class="speed-title">Velocità</div>
               <div class="speed-arc">
                   <!-- I LED verranno creati via JavaScript -->
               </div>
               <div class="speed-display">
                   <div class="speed-value">0</div>
                   <div class="speed-unit">km/h</div>
               </div>
           </div>
       </div>

       <!-- Sezione Metriche (2/3 destro) -->
       <div class="metrics-section">
           <!-- Batteria -->
           <div class="metric-card">
               <h3>Batteria</h3>
               <div id="battery" class="metric-value">0%</div>
               <div class="led-container battery-segments"></div>
           </div>

           <!-- Livello Assistenza -->
           <div class="metric-card">
               <h3>Livello Assistenza</h3>
               <div id="assist-level" class="metric-value">ECO</div>
               <div class="led-container assist-levels"></div>
           </div>

           <!-- Potenza -->
           <div class="metric-card">
               <h3>Potenza</h3>
               <div id="power" class="metric-value">0 W</div>
               <div class="led-container power-segments"></div>
           </div>

           <!-- Cadenza -->
           <div class="metric-card">
               <h3>Cadenza</h3>
               <div id="cadence" class="metric-value">0</div>
               <div>RPM</div>
           </div>

           <!-- Pendenza -->
           <div class="metric-card">
               <h3>Pendenza</h3>
               <div id="slope" class="metric-value">0%</div>
               <div class="led-container slope-segments"></div>
           </div>

           <!-- Autonomia -->
           <div class="metric-card">
               <h3>Autonomia</h3>
               <div id="range" class="metric-value">0</div>
               <div>km</div>
           </div>
       </div>
   </div>

   <script>
     <script>
       // Inizializzazione degli elementi UI
       function initializeUI() {
           // Crea i LED del tachimetro (50 segmenti su 270 gradi)
           const speedArc = document.querySelector('.speed-arc');
           for (let i = 0; i < 50; i++) {
               const led = document.createElement('div');
               led.className = 'speed-led';
               // Calcola l'angolo per ogni LED (-135 a +135 gradi per un arco di 270 gradi)
               const angle = -135 + (i * (270 / 49));
               // Raggio ridotto a 55px per contenere l'arco nel riquadro
               led.style.transform = `rotate(${angle}deg) translateY(-55px)`;
               speedArc.appendChild(led);
           }

           // Crea i segmenti della batteria (10 segmenti)
           const batteryContainer = document.querySelector('.battery-segments');
           for (let i = 0; i < 10; i++) {
               const segment = document.createElement('div');
               segment.className = 'led-segment battery-segment';
               batteryContainer.appendChild(segment);
           }

           // Crea i segmenti della potenza (10 segmenti per 400W)
           const powerContainer = document.querySelector('.power-segments');
           for (let i = 0; i < 10; i++) {
               const segment = document.createElement('div');
               segment.className = 'led-segment power-segment';
               powerContainer.appendChild(segment);
           }

           // Crea i segmenti della pendenza (10 segmenti: 5 per salita, 5 per discesa)
           const slopeContainer = document.querySelector('.slope-segments');
           for (let i = 0; i < 10; i++) {
               const segment = document.createElement('div');
               segment.className = 'led-segment slope-segment';
               slopeContainer.appendChild(segment);
           }

           // Crea i segmenti del livello di assistenza (3 segmenti)
           const assistContainer = document.querySelector('.assist-levels');
           for (let i = 0; i < 3; i++) {
               const segment = document.createElement('div');
               segment.className = 'led-segment assist-level';
               assistContainer.appendChild(segment);
           }
       }

       // Funzioni di aggiornamento UI
       function updateSpeed(speed) {
           document.querySelector('.speed-value').textContent = Math.round(speed);
           const leds = document.querySelectorAll('.speed-led');
           const activeCount = Math.floor(speed);
           leds.forEach((led, index) => {
               led.className = 'speed-led';
               if (index < activeCount) {
                   led.classList.add('active');
                   if (index < 20) { // 0-20 km/h verde
                       led.classList.add('eco');
                   } else if (index < 25) { // 21-25 km/h giallo
                       led.classList.add('cruise');
                   } else { // 26-50 km/h rosso
                       led.classList.add('power');
                   }
               }
           });
       }

       function updateBattery(percentage) {
           document.getElementById('battery').textContent = percentage + '%';
           const segments = document.querySelectorAll('.battery-segment');
           const activeSegments = Math.floor(percentage / 10);
           segments.forEach((segment, index) => {
               segment.className = 'led-segment battery-segment';
               if (index < activeSegments) {
                   if (index < 2) {
                       segment.classList.add('reserve');
                   } else {
                       segment.classList.add('active');
                   }
               }
           });
       }

       function updatePower(watts) {
           document.getElementById('power').textContent = watts + ' W';
           const segments = document.querySelectorAll('.power-segment');
           const maxPower = 400;
           const activeCount = Math.floor((watts / maxPower) * segments.length);
           segments.forEach((segment, index) => {
               segment.className = 'led-segment power-segment';
               if (index < activeCount) {
                   if (index < segments.length * 0.4) {
                       segment.classList.add('active', 'low');
                   } else if (index < segments.length * 0.7) {
                       segment.classList.add('active', 'medium');
                   } else {
                       segment.classList.add('active', 'high');
                   }
               }
           });
       }

       function updateSlope(percentage) {
           document.getElementById('slope').textContent = percentage + '%';
           const segments = document.querySelectorAll('.slope-segment');
           const midPoint = segments.length / 2;
           segments.forEach((segment, index) => {
               segment.className = 'led-segment slope-segment';
               if (percentage > 0) {
                   if (index >= midPoint) {
                       const threshold = (index - midPoint + 1) * (80 / midPoint);
                       if (percentage >= threshold) {
                           segment.classList.add('climb');
                       }
                   }
               } else if (percentage < 0) {
                   if (index < midPoint) {
                       const threshold = (midPoint - index) * (50 / midPoint);
                       if (Math.abs(percentage) >= threshold) {
                           segment.classList.add('descent');
                       }
                   }
               }
           });
       }

       function updateAssistLevel(level) {
           const levels = {
               1: { name: 'ECO', segments: [true, false, false] },
               2: { name: 'TRAIL', segments: [true, true, false] },
               3: { name: 'TURBO', segments: [true, true, true] }
           };
           document.getElementById('assist-level').textContent = levels[level].name;
           const segments = document.querySelectorAll('.assist-level');
           segments.forEach((segment, index) => {
               segment.className = 'led-segment assist-level';
               if (levels[level].segments[index]) {
                   segment.classList.add(index === 0 ? 'eco' : index === 1 ? 'trail' : 'turbo');
               }
           });
       }

       function updateCadence(rpm) {
           document.getElementById('cadence').textContent = rpm;
       }

       function updateRange(km) {
           document.getElementById('range').textContent = km;
       }

       // Gestione Bluetooth
       const connectButton = document.getElementById('connect-button');
       let device = null;

       async function connectToBike() {
           try {
               device = await navigator.bluetooth.requestDevice({
                   filters: [
                       { services: ['cycling_speed_and_cadence'] },
                       { namePrefix: 'Specialized' }
                   ],
                   optionalServices: ['battery_service']
               });

               const server = await device.gatt.connect();
               console.log('Connesso al dispositivo:', device.name);
               connectButton.textContent = 'Disconnetti';
               
           } catch (error) {
               console.error('Errore di connessione:', error);
               connectButton.textContent = 'Riprova';
               alert('Errore di connessione: ' + error.message);
           }
       }

       connectButton.addEventListener('click', connectToBike);

       // Gestione orientamento schermo
       function lockScreenOrientation() {
           try {
               if (screen.orientation && screen.orientation.lock) {
                   screen.orientation.lock('landscape');
               }
           } catch (e) {
               console.log('Orientamento schermo non supportato');
           }
       }

       // Inizializza l'UI al caricamento
       document.addEventListener('DOMContentLoaded', () => {
           initializeUI();
           lockScreenOrientation();
           
           // Demo per test (da rimuovere in produzione)
           setTimeout(() => {
               updateBattery(85);
               updateAssistLevel(2);
               updateSpeed(28);
               updatePower(250);
               updateSlope(15);
               updateCadence(75);
               updateRange(45);
           }, 1000);
       });
   </script>
</body>
</html>
